# Git进阶操作入门

虽然已经用过`git`管理过很多仓库了，但是之前使用的时候无非就是`add`、`commit`、`push`三个反复地用

有时也就是清清暂存区什么的，然后对于版本库的其他操作比如版本回退什么的，都没怎么用过

所以这篇文档就来实际上手，总结一下一些不那么基础的操作，也算是以后维护项目需要用到的知识





### 一、先决条件

首先我们需要初始化一个`git`仓库，然后将初始化的内容先推送到远程仓库

这里我新建了一个`git-learn`本地仓库，里面有一个`test.txt`文件

![](http://ldmblog.ifoodin.com/20231020174150.png)





### 二、还没有add的操作



##### 1. git checkout -- {file}

我们在`test.txt`中随便添加一些东西，然后查看它的状态：

![](http://ldmblog.ifoodin.com/20231020194416.png)

然后我们先`add`到暂存区，之后我们再对这个文件作修改，但是这次不`add`到暂存区

然后我们执行如下命令：

```sh
git checkout -- test.txt
```

这个命令其实就是让我们的工作区的文件恢复到上一次`add`的状态，现在你就可以看到我们第二次作的修改就消失了

除此之外，这个命令还能在我们删除文件后将文件状态恢复至现在的暂存区的状态

所以，总的来说这条命令的作用可以归结如下：

* 如果当前工作区与当前暂存区的状态一致，那么当前的暂存区就回退到再上一次`add`的时候
* 如果当前工作区与当前暂存区状态不一致，那么就将当前工作区的文件回退为当前暂存区的状态





### 三、已经add了的操作

众所周知，`add`就是把本地仓库的工作区，添加到暂存区中

那么我们在`add`之前，发现自己有一些地方搞错了，然后想要撤销工作区的修改，我们怎么做呢？



##### 1. git rm --cached {file}

直接把缓存区的文件全部都清掉，这是最简单暴力的做法

比如我们在`add`的时候，发现有一些文件没有忽略掉，那么我们就可以直接清空暂存区，配置好`.gitignore`后再重新`add`

我们来实际操作看一下，例如我现在给`test.txt`添加一行内容：

![](http://ldmblog.ifoodin.com/20231020174620.png)

此时我们输入`git status`查看本地仓库的状态，可以发现暂存区是没有东西`commit`的：

![](http://ldmblog.ifoodin.com/20231020174754.png)

然后我们`add`一下，可以看到暂存区已经有东西了：

![](http://ldmblog.ifoodin.com/20231020174933.png)

那么我们这时把暂存区都清空掉，输入如下命令，这条命令表示删除当前目录下暂存区的全部文件：

```sh
git rm --cached -r .
```

此时我们再查看`git`本地仓库的状态，此时我们可以发现，它把暂存区的`test.txt`文件移除了：

![](http://ldmblog.ifoodin.com/20231020180025.png)

如果只想清掉某个文件，那么可以用如下命令：

```sh
git rm --cached <文件名>
```



##### 2. git reset HEAD {file}

如果`add`之后发现不对，可以用`git reset Head`命令把暂存区的文件设为未暂存状态

其实这个命令在实际使用中效果和`git rm --cache <file>`是差不多的

如果要清掉暂存区的所有文件，就用如下命令：

```sh
git reset HEAD .
```

如果只想清掉某些文件，就可以用如下命令：

```sh
git reset HEAD <file>
```





### 四、已经commit了的操作

上面说的是已经`add`但还没有`commit`的操作，现在是已经`commit`了的操作

首先我们要知道`git log`可以查看所有的`commit`操作：

![](http://ldmblog.ifoodin.com/20231020211301.png)

然后要知道`git reflog`可以查看更多类型的操作：

![](http://ldmblog.ifoodin.com/20231020211720.png)





##### 1. git reset {commit id}

我们在`commit`了之后可以通过`git log`来查找对应的`commit id`，然后使用`git reset`命令，将版本回退到之前的状态

此时我们分别输入如下命令查看：

* `git log`

![](http://ldmblog.ifoodin.com/20231020212248.png)

* `git reflog`

![](http://ldmblog.ifoodin.com/20231020212145.png)

可以发现，版本回退了之后，只有`git reflog`才能查看“未来”的版本，而`git log`是不行的，它会随着版本一起回退

需要注意的是，这样写的话只会重置`HEAD`指针的位置，并修改暂存区，使其与回退版本后的`commit`一致

如果想要连同工作区一起修改，那么就需要加上`--hard`参数：

```sh
git reset --hard <commit id>
```

![](http://ldmblog.ifoodin.com/20231020213105.png)

此时你会发现`git`有提示说你的本地仓库落后了远程仓库两个`commit`，这是因为你使用了`--hard`参数

而`--hard`参数是强制重置你的工作区的文件状态，所以你就落后了